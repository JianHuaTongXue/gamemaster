<div xmlns:th="http://www.w3.org/1999/xhtml" class="pageHeader">

    <form id="pagerForm" onsubmit="return ajaxNavTab(this);" action="game/notice" method="post"
          onreset="$(this).find('select.combox').comboxReset()">
        <div class="searchBar">
            <table class="searchContent">
                <tr>
                    <td>公告状态：</td>
                    <td>
                        <select name="enable">
                            <option value="1" th:selected="${notice.enable==1}">显示</option>
                            <option value="0" th:selected="${notice.enable==0}">隐藏</option>
                        </select>
                    </td>
                    <td>标题：</td>
                    <td><input name="title" type="text" th:value="${notice.title}" class="required"/></td>
                    <td>有效时间：</td>
                    <td>
                        <input dateFmt="yyyy-MM-dd HH:mm:ss" name="startTime" class="date readonly" readonly="readonly"
                               type="text" th:value="${notice.startTime}">
                        <span class="limit">-</span>
                        <input dateFmt="yyyy-MM-dd HH:mm:ss" name="endTime" class="date readonly" readonly="readonly"
                               type="text" th:value="${notice.endTime}">
                    </td>
                    <td><input type="color" value="#2D9900" id="color"/></td>
                    <td><input type="button" value="改变颜色" id="test"></td>
                    <td><input type="button" value="预览" id="preview"></td>
                    <td th:if="${notice.id==null}">
                        <input type="submit" value="提交">
                        <input name="type" type="hidden" value="add">
                    </td>

                    <td th:if="${notice.id!=null}">
                        <input type="submit" value="更新">
                        <input name="type" type="hidden" value="update">
                        <input name="id" type="hidden" th:value="${notice.id}">
                    </td>
                </tr>
                <tr>
                    <td>内容：</td>
                    <td colspan="3"><textarea id="content" name="content" cols="43" rows="20" style="resize:none;"
                                              th:text="${notice.content}" class="required"></textarea></td>
                    <td>预览：</td>
                    <td>
                        <div id="previewView" name="content" style="background-color:#000000;width:300px;height:300px;padding-top:5px;padding-left:5px;word-break:break-all;word-wrap:break-word;white-space:normal" ></div>
                    </td>
                </tr>
            </table>
        </div>
    </form>
</div>
<div class="pageHeader">
    <form onsubmit="return ajaxNavTab(this);" action="game/notice" method="post" onreset="$(this).find('select.combox').comboxReset()">
        <div class="searchBar">
            <table class="searchContent">
                <tr>
                    <td class="dateRange">
                        日期:
                        <input name="startDate" class="date readonly" readonly="readonly" type="text" th:value="${request.startDate}">
                        <span class="limit">-</span>
                        <input name="endDate" class="date readonly" readonly="readonly" type="text" th:value="${request.endDate}">
                    </td>
                    <td>
                        <div class="buttonActive">
                            <div class="buttonContent">
                                <button type="submit">检索</button>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </form>
</div>
<div class="pageContent">
    <table class="table" width="100%" layoutH="137">
        <thead>
        <tr>
            <th>ID</th>
            <th>标题</th>
            <th>内容</th>
            <th>开始时间</th>
            <th>结束时间</th>
            <th>状态</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${list.size()!=0}" th:each="row,iterStat:${list}">
            <td th:text="${row.id}"></td>
            <td th:text="${row.title}"></td>
            <td th:text="${row.content}"></td>
            <td th:text="${row.startTime}"></td>
            <td th:text="${row.endTime}"></td>
            <td th:if="${row.enable==0}" th:text="隐藏"></td>
            <td th:if="${row.enable==1}" th:text="显示"></td>
            <td>
                <a th:if="${row.enable==0}" class="button" th:href="@{game/notice(id=${row.id},type='open')}"
                   target="navTab"><span>显示</span></a>
                <a th:if="${row.enable==1}" class="button" th:href="@{game/notice(id=${row.id},type='close')}"
                   target="navTab"><span>隐藏</span></a>
                <a class="button" th:href="@{game/notice(id=${row.id},type='modify')}"
                   target="navTab"><span>编辑</span></a>
                <a class="button" th:href="@{game/notice(id=${row.id},type='delete')}"
                   target="navTab"><span>删除</span></a>
            </td>
        </tr>
        <tr th:if="${list.size()==0}">
            <td colspan="6" style="text-align: center">暂无数据</td>
        </tr>
        </tbody>
    </table>
    <div th:replace="_include/pager"></div>
</div>
<script type="text/javascript">
var selectionStart, selectionEnd;
    var textarea = document.getElementById("content");

    document.onkeyup = document.onmouseup = function(event){
        event = event || window.event;
        var keyCode = event.keyCode || event.which;

        var userSelection;
        if (window.getSelection) { //现代浏览器
            userSelection = window.getSelection();
        } else if (document.selection) { //IE浏览器 考虑到Opera，应该放在后面
            userSelection = document.selection.createRange();
        }

        var getRangeIndex = function(selectionObject) {
            if (window.getSelection)
                return [textarea.selectionStart, textarea.selectionEnd];
            else { // 较老版本Safari!
                var range               = document.selection.createRange();             //对选择的文字create Range
                // var selectText          = range.text;                                //选中的文字
                var selectTextLength    = range.text.length;                            //选中文字长度
                textarea.select();                                                      //textarea全选
                //StartToStart、StartToEnd、EndToStart、EndToEnd
                range.setEndPoint("StartToStart", document.selection.createRange());    //指针移动到选中文字开始
                var selectTextPosition  = range.text.length;                            //选中文字的结束位置
                range.collapse(false);                                                  //将插入点移动到当前范围的开始
                range.moveEnd("character", -selectTextLength);   //更改范围的结束位置，减去长度，字符开始位置，character不能改
                range.moveEnd("character", selectTextLength);   //再更改范围的结束位置，到字符结束位置
                range.select();                                                         //然后选中字符

                //返回字符的开始和结束位置
                return [selectTextPosition - selectTextLength, selectTextPosition];
            }
        }

        var rangeIndex = getRangeIndex(userSelection);
        selectionStart = rangeIndex[0];
        selectionEnd   = rangeIndex[1];
    };
    $('#preview').click(function () {
        <!--$("#previewView").val($("#content").val())-->
         var runTextArea = document.getElementById('content').value;
         var reg = new RegExp( '<color' , "g" );
         runTextArea=runTextArea.replace(reg,"<font color");
          var reg2 = new RegExp( '</color>' , "g" )
          runTextArea=runTextArea.replace(reg2,"</font>");
          if(runTextArea.indexOf("E6DDCDFF") == -1)
          {
          runTextArea="<font color='E6DDCDFF'>"+runTextArea+"</font>";
          }
          var str=runTextArea;
          str = str.replace(/\r\n/g, '<br/>'); //IE9、FF、chrome
		str = str.replace(/\n/g, '<br/>'); //IE7-8
		str = str.replace(/\s/g, ' '); //空格处理
          var result = document.getElementById('previewView');
           result.innerHTML = str;
    });
  $('#test').click(function () {
           textarea.value = textarea.value.substring(0, selectionStart)
            + '<color='+document.getElementById("color").value+'>' + textarea.value.substring(selectionStart, selectionEnd)
            + '</color>' + textarea.value.substring(selectionEnd);
             $("#preview").click();
    });

</script>