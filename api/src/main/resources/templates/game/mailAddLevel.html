<div class="pageContent" xmlns:th="http://www.w3.org/1999/xhtml">
    <form method="post" onsubmit="return closeNavTab(this);" action="operatingTools/sendmail" class="pageForm required-validate">
        <input type="hidden" name="mailType" value="2"/>
        <table width="98%" style="height:100%;border-collapse:separate; border-spacing:5px;">
            <thead>
            <tr>
                <th width="20%"></th>
                <th width="80%"></th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>
                    <label>区服类型</label>
                </td>
                <td>
                    <select name="serverGroup" id="serverType">
                        <option value="">全部</option>
                        <option value="ingcle" th:selected="${request.serverGroup=='ingcle'}">硬核专服</option>
                        <option value="ingcle_mixture" th:selected="${request.serverGroup=='ingcle_mixture'}">大混服专服</option>
                        <option value="ingcle_iOS" th:selected="${request.serverGroup=='ingcle_iOS'}">IOS专服</option>
                        <option value="other" th:selected="${request.serverGroup=='other'}">其他</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td><input type="checkbox" id="allSelect"/>全选</td>
                <td id="serverList">
                    <input class="required" th:each="row:${serverList}" type="checkbox" name="ids" th:text="${row.serverName}" th:value="${row.serverId}"/>
                </td>
            </tr>
            <tr>
                <td>最小等级</td>
                <td><input type="number" name="minLev" class="required"/></td>
            </tr>
            <tr>
                <td>最大等级</td>
                <td><input type="number" name="maxLev" class="required"/></td>
            </tr>
            <tr>
                <td>发件人</td>
                <td><input type="text" title="发件人" value="系统邮件" name="sender" class="required textInput"/></td>
            </tr>
            <tr>
                <td>邮件标题</td>
                <td><input type="text" title="标题" value="" name="title" class="required textInput"/></td>
            </tr>
            <tr>
                <td>邮件内容</td>
                <td>
                    <textarea name="content" class="required textArea" cols="30" rows="4" style="resize: none"></textarea>
                </td>
            </tr>
            <tr>
                <td>物品</td>
                <td>
                    <select id="lev_goods">
                        <option th:each="goods:${goodsList}" th:text="${goods.name}" th:value="${goods.id}"></option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>数量</td>
                <td>
                    <input type="number" id="lev_count" min="1"/>
                    <input type="button" value="添加" id="addButton"/>
                    <input type="button" value="删除最后一个" id="deleteButton"/>
                </td>
            </tr>
            <tr>
                <td>奖励</td>
                <td>
                    <textarea name="rewards" class="textArea readonly" cols="30" rows="4" style="resize: none;margin-top: 10px" id="reward" readonly="readonly"></textarea>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <button type="submit">发送</button>
                    <button class="close">取消</button>
                </td>
            </tr>
            </tbody>
        </table>
    </form>
</div>
<script type="text/javascript">
    $(function () {
        $('#mail_goods').searchableSelect();
    });
    $('#allSelect').click(function () {
        var ids = $('input[name=ids]');
        for (var i = 0; i < ids.length; i++) {
            if ($(this).prop("checked")) {
                ids.eq(i).prop("checked", true);
            } else {
                ids.eq(i).prop("checked", false);
            }
        }
    });
    $('#addButton').click(function () {
        var goods = $('#lev_goods').val();
        var count = $('#lev_count').val();
        if (count > 0) {
            $('#reward').val($('#reward').val() + goods + ":" + count + ";\n");
        } else {
            alert("请选择物品数量");
        }
    });
    $('#deleteButton').click(function () {
        var reward = $('#reward').val();
        if (reward != '') {
            var strings = reward.split(";");
            var rewardStr = "";
            for (var i = 0; i < strings.length - 2; i++) {
                rewardStr += strings[i] + ";"
            }
            $('#reward').val(rewardStr);
        } else {
            alert("未添加奖励");
        }
    });
    $('#serverType').change(function () {
        $.post("startup/server_list", "serverGroup=" + $(this).val(), function (data) {
            var serverList = $('#serverList');
            serverList.empty();
            for (var i = 0, l = data.length; i < l; i++) {
                var serverName = data[i].serverName;
                var serverId = data[i].serverId;
                serverList.append("<input class='required' type='checkbox' name='ids' value='" + serverId + "'/>"+serverName)
            }
        });
    });
</script>